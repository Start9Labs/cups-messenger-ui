<ion-header translucent>
    <ion-toolbar>   
        <ion-title color="primary">Contacts</ion-title>               
        <ion-buttons collapse="true" slot="end">
            <ion-button fill="clear" (click)="logout()">
                Logout
              </ion-button>
        </ion-buttons> 
      </ion-toolbar>
</ion-header>

<ion-content>
  <ion-item-group>
      <div *ngFor="let contact of (app.emitContacts$ | async); index as i" >
            <ion-item-sliding>
            
                <div *ngIf="app.emitMostRecentServerMessage$(contact) | async as message; else loadMessages">
                    <ion-item class="item-contact" lines="full" detail='true' detail-icon="chevron-back-outline" button (click)="jumpToChat(contact)">
                        <ion-avatar [class.item-avatar]="contact.unreadMessages === 0" [class.item-avatar-unreads]="contact.unreadMessages > 0" slot="start">
                            <text-avatar [text]='(contact | truncateEllipses:12)'></text-avatar>
                        </ion-avatar>
                        <ion-label>{{ (contact | truncateEllipses:18) }}</ion-label>
                        <ion-item>{{ message.text.slice(0,12) }}</ion-item>
                    </ion-item>
                    <ion-item-options side="end" lines="full">
                        <ion-item-option color="primary" (click)="editContact(contact)">Edit</ion-item-option>
                        <ion-item-option  text-color="warning" color="light" (click)="deleteContact(contact)">Delete</ion-item-option>
                    </ion-item-options>
                </div>

                <ng-template #loadMessages>
                    <div *ngIf="contact.unreadMessages === 0; else loader">
                        <ion-item class="item-contact" lines="full" detail='true' detail-icon="chevron-back-outline" button (click)="jumpToChat(contact)">
                            <ion-avatar class="item-avatar" slot="start">
                                <text-avatar [text]='(contact | truncateEllipses:12)'></text-avatar>
                            </ion-avatar>
                            <ion-label>{{ (contact | truncateEllipses:18) }}</ion-label>
                            <ion-item> --- </ion-item>
                        </ion-item>
                        <ion-item-options side="end" lines="full">
                            <ion-item-option color="primary" (click)="editContact(contact)">Edit</ion-item-option>
                            <ion-item-option  text-color="warning" color="light" (click)="deleteContact(contact)">Delete</ion-item-option>
                        </ion-item-options>
                    </div>
                    
                    <ng-template #loader>
                        <ion-item class="item-contact" lines="full" detail='true' detail-icon="chevron-back-outline" button disabled (click)="jumpToChat(contact)">
                            <ion-avatar  class="item-avatar-unreads" slot="start">
                                <text-avatar [text]='(contact | truncateEllipses:12)'></text-avatar>
                            </ion-avatar>
                            <ion-label>{{ (contact | truncateEllipses:18) }}</ion-label>
                            <ion-spinner name="crescent"></ion-spinner>
                        </ion-item>
                    </ng-template>
                </ng-template>

                

                
                
                
            </ion-item-sliding>
      </div>
</ion-item-group>  
<ion-fab class="ion-padding" vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button class="new-contact-button" size="small" fill="clear" color="primary" (click)="toNewContactPage()">
        <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
</ion-fab>

</ion-content>

<ion-footer>
</ion-footer>